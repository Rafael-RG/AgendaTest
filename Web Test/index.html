<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agregar nuevo evento al calendario</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        text-align: center;
    }
    h1 {
        margin-bottom: 20px;
    }
    .evento-input {
        margin-bottom: 10px;
    }
    #agregarEvento {
        padding: 15px 30px;
        font-size: 18px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    #agregarEvento:hover {
        background-color: #45a049;
    }
    #errorMensaje {
        color: red;
        margin-top: 10px;
    }
</style>
</head>
<body>
<h1>Agregar nuevo evento al calendario</h1>
<form id="formularioEvento">
    <input type="text" class="evento-input" id="titulo" placeholder="Título del evento" required><br>
    <input type="datetime-local" class="evento-input" id="fechaInicio" required><br>
    <input type="datetime-local" class="evento-input" id="fechaFin" required><br>
    <input type="text" class="evento-input" id="ubicacion" placeholder="Ubicación"><br>
    <input type="text" class="evento-input" id="descripcion" placeholder="Descripción"><br>
    <button type="submit" id="agregarEvento">Agregar evento al calendario</button>
</form>
<p id="errorMensaje"></p>

<script>
document.getElementById('formularioEvento').addEventListener('submit', function(event) {
    event.preventDefault(); // Evitar que se envíe el formulario
    
    var titulo = document.getElementById('titulo').value;
    var fechaInicio = new Date(document.getElementById('fechaInicio').value.replace('T', ' ')); // Reemplazar 'T' por espacio
    var fechaFin = new Date(document.getElementById('fechaFin').value.replace('T', ' '));
    var ubicacion = document.getElementById('ubicacion').value;
    var descripcion = document.getElementById('descripcion').value;

    // Validar que la fecha de inicio sea anterior a la fecha de fin
    if (fechaInicio >= fechaFin) {
        mostrarError('La fecha de inicio debe ser anterior a la fecha de fin.');
        return;
    }

    var enlaceCalendario = 'webcal:///?v=1&title=' + encodeURIComponent(titulo) + '&start=' + encodeURIComponent(fechaInicio.toISOString()) + '&end=' + encodeURIComponent(fechaFin.toISOString());
    if (ubicacion) {
        enlaceCalendario += '&location=' + encodeURIComponent(ubicacion);
    }
    if (descripcion) {
        enlaceCalendario += '&description=' + encodeURIComponent(descripcion);
    }

    // Intentar abrir la URL en una nueva pestaña
    var nuevaPestana = window.open(enlaceCalendario, '_blank');
    if (!nuevaPestana || nuevaPestana.closed || typeof nuevaPestana.closed == 'undefined') {
        // Si no se puede abrir la nueva pestaña, mostrar mensaje de error
        mostrarError('Error: No se pudo abrir la aplicación de calendario.');
    }
});

function mostrarError(mensaje) {
    var errorMensajeElemento = document.getElementById('errorMensaje');
    errorMensajeElemento.textContent = mensaje;
}
</script>
</body>
</html>
